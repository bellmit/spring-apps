package com.haozhuo.datag.service.biz;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.haozhuo.datag.common.Tuple;
import com.haozhuo.datag.model.glu.*;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.boot.web.client.RestTemplateBuilder;
import org.springframework.stereotype.Component;

import java.util.*;

import static java.util.Arrays.stream;
import static java.util.stream.Collectors.toList;

/**
 * Created by Lucius on 8/27/18.
 */
@SuppressWarnings({"unused", "ConstantConditions"})
@Component
public class GluService {
    private static final Logger logger = LoggerFactory.getLogger(GluService.class);

    private final Map<String, String> checkIndexRegexMap;
    private final Map<String, Tuple<Double, Double>> textRefMap;
    private final static String excludeRegex = ".*([比/\\\\]).*";
    @Autowired
    private RestTemplateBuilder restTemplate;

    private final ObjectMapper mapper = new ObjectMapper();
    @Value("${app.rest.glu}")
    private String url;

    public GluService() {
        checkIndexRegexMap = new HashMap<>();
        checkIndexRegexMap.put("收缩压", "^收缩压$");
        checkIndexRegexMap.put("舒张压", "^舒张压$");
        checkIndexRegexMap.put("血糖（空腹）", "(?=.*空腹)(?=.*血糖)^.*");
        checkIndexRegexMap.put("体重", "^体重$");
        checkIndexRegexMap.put("身高", "^身高$");
        checkIndexRegexMap.put("高密度脂蛋白", ".*高密度脂.*");
        checkIndexRegexMap.put("低密度脂蛋白", ".*低密度脂.*");
        checkIndexRegexMap.put("甘油三酯", ".*甘油三.*");
        checkIndexRegexMap.put("总胆固醇", ".*总胆固醇.*");
        textRefMap = new HashMap<>();
        textRefMap.put("低密度脂蛋白", new Tuple<>(1.3D, 4.3D));
        textRefMap.put("高密度脂蛋白", new Tuple<>(0.8D, 1.96D));
        textRefMap.put("甘油三酯", new Tuple<>(0.45D, 1.8D));
        textRefMap.put("总胆固醇", new Tuple<>(2.33D, 5.7D));
        textRefMap.put("血糖（空腹）", new Tuple<>(3.9D, 6.1D));
    }


    public ReportObjData getAndParseReport(Long reportId) {
        try {
            ReportHttpMsg reportHttpMsg = restTemplate.build().getForObject(String.format(url, reportId), ReportHttpMsg.class);
            String userInfoJson = reportHttpMsg.getData().getUserInfo().replaceAll("\"", "\"");
            //String userInfoJson= "{\"age\":45,\"sex\":1}";
            UserInfo userInfo = mapper.readValue(userInfoJson, UserInfo.class);
            String reportJson = reportHttpMsg.getData().getReportContent().replaceAll("\"", "\"");
            //String reportJson = "{\"checkItems\":[{\"checkItemName\":\"一般检查(1)\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"身高\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"175.0\",\"textRef\":\"\",\"unit\":\"Cm\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"体重\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"72.0\",\"textRef\":\"\",\"unit\":\"kg\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"体重指数(18.5-23.9)\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"23.50\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"理想体重(kg)\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"67.50\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"收缩压\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"116\",\"textRef\":\"\",\"unit\":\"mmHg\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"舒张压\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"86\",\"textRef\":\"\",\"unit\":\"mmHg\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"脉搏（次/分）\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"90\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"小结\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"体重指数:23.50\\n血压:116/86mmHg\\n脉搏:90 次/分\",\"textRef\":\"\",\"unit\":\"\"}],\"checkUserName\":\"张书文\",\"departmentName\":\"\"},{\"checkItemName\":\"内科检查\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"病史\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"无\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"心率\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"88\",\"textRef\":\"\",\"unit\":\"次/分\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"呼吸\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"16\",\"textRef\":\"\",\"unit\":\"次/分\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"心律\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"整齐\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"心音\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见异常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"心脏杂音\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见异常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"肺罗音\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见异常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"呼吸音\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见异常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"腹壁\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见异常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"肝大小\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见异常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"肝脏质地\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见异常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"肝脏压痛\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见异常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"脾大小\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见异常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"脾脏质地\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见异常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"脾脏压痛\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见异常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"其他\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见异常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"小结\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"内科检查未见异常\",\"textRef\":\"\",\"unit\":\"\"}],\"checkUserName\":\"吴月兰\",\"departmentName\":\"\"},{\"checkItemName\":\"外科检查\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"皮肤颜色\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见异常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"皮疹\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"无\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"皮下肿块\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"无\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"水肿\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"无\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"蜘蛛痣\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"无\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"疤痕部位\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"右下腹疤痕：阑尾炎术后\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"溃疡部位\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"无\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"糜烂部位\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"无\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"淋巴结\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见异常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"甲状腺\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见异常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"乳房\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见异常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"四肢关节\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见异常，活动自如\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"脊柱\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见异常，活动自如\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"肛门指检\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"直肠指检：弃查\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"疝\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"无\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"包皮\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见异常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"阴茎\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见异常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"睾丸\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见异常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"前列腺\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"弃查\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"其他检查\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"无\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"小结\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"右下腹疤痕：阑尾炎术后\\n直肠指检：弃查\\n余外科检查未见异常\",\"textRef\":\"\",\"unit\":\"\"}],\"checkUserName\":\"李金龙\",\"departmentName\":\"\"},{\"checkItemName\":\"耳鼻喉检查(1)\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"耳廓\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"正常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"外耳道\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"正常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"鼓膜\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"正常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"乳突（耳）\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"正常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"鼻外形\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"正常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"鼻中隔\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"正常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"鼻腔黏膜及分泌物\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"正常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"鼻甲\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"正常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"鼻窦压痛\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"无\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"口咽黏膜\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"正常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"口咽悬雍垂\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"正常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"扁桃体\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"正常\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"其它\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"小结\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"耳鼻咽喉科检查未见异常\",\"textRef\":\"\",\"unit\":\"\"}],\"checkUserName\":\"华玉娥9\",\"departmentName\":\"\"},{\"checkItemName\":\"心电图\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"小结\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"正常心电图\",\"textRef\":\"\",\"unit\":\"\"}],\"checkUserName\":\"沈夏花/周玉芬\",\"departmentName\":\"\"},{\"checkItemName\":\"肝胆脾胰肾彩超\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"肝\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"肝脏形态大小正常，轮廓规整，肝内回声稍呈点状密集弥漫性增强，肝内管道结构尚清晰。\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"胆\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"胆囊形态大小正常，壁厚：3mm，稍毛糙，囊腔内可见一个团状强回声，大小约9mmx5mm。后方伴声影，随体位改变而移动。\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"胰\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"胰腺大小、形态正常，边缘规整，内部回声均匀，胰管未见扩张。\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"脾\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"脾脏大小、形态正常，包膜光整，内部回声均匀。\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"左肾\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"左肾大小、形态正常，包膜光滑，肾实质回声均匀，集合系统未见明显分离。\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"右肾\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"右肾大小、形态正常，包膜光滑，肾实质回声均匀，集合系统未见明显分离。\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"小结\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"肝:脂肪肝趋势\\n胆:胆囊结石\\n胰、脾、左肾、右肾未发现明显异常\",\"textRef\":\"\",\"unit\":\"\"}],\"checkUserName\":\"钱建芬\",\"departmentName\":\"\"},{\"checkItemName\":\"甲状腺超声\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"描述\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"甲状腺形态大小正常，甲状腺左叶内见多个低回声结节，最大约2.5mm×1mm，结节周边无血管环绕。\\n右叶甲状腺未见明显异常。\\n\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"小结\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"甲状腺左叶结节（多发）\",\"textRef\":\"\",\"unit\":\"\"}],\"checkUserName\":\"钱建芬\",\"departmentName\":\"\"},{\"checkItemName\":\"前列腺超声\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"前列腺\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"前列腺大小、形态正常，包膜光滑完整，两侧对称，内部回声均匀。\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"小结\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"前列腺未发现明显异常\",\"textRef\":\"\",\"unit\":\"\"}],\"checkUserName\":\"钱建芬\",\"departmentName\":\"\"},{\"checkItemName\":\"CT检查(胸部)\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"描述\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"两肺未见异常密度影。两肺纹理清晰。所示气管支气管影通畅。两肺门及纵隔内未见异常肿大的淋巴结。纵隔内大血管未见明显异常。心影正常。两侧胸腔未见明显积液。附见：左侧甲状腺下叶小圆形略低密度影。\\n\\n\\n\\n诊断：1.胸部CT平扫未见明显异常。\\n      2.附见：左侧甲状腺下叶小圆形略低密度影，建议进一步检查。\\n\",\"textRef\":\"\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"小结\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"\",\"textRef\":\"\",\"unit\":\"\"}],\"checkUserName\":\"修磊/朱伟义2\",\"departmentName\":\"\"},{\"checkItemName\":\"动脉粥样硬化指数\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"动脉粥样硬化指数\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":3,\"resultValue\":\"4.15 ↑\",\"textRef\":\"0-4\",\"unit\":\"\"}],\"checkUserName\":\"代斌/凌伟\",\"departmentName\":\"\"},{\"checkItemName\":\"肝功一项(ALT)\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"血清谷丙转氨酶\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"49.77\",\"textRef\":\"1-65\",\"unit\":\"U/L\"}],\"checkUserName\":\"代斌/凌伟\",\"departmentName\":\"\"},{\"checkItemName\":\"甲状腺功能三项（T3  T4  TSH）\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"三碘甲状腺原氨酸\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"1.320\",\"textRef\":\"0.85-2.2\",\"unit\":\"ng/ml\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"甲状腺素\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"74.042\",\"textRef\":\"42-135\",\"unit\":\"ug/ml\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"血清促甲状腺激素\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"1.078\",\"textRef\":\"0.25-4.50\",\"unit\":\"uIU/ml\"}],\"checkUserName\":\"黎芳/凌伟\",\"departmentName\":\"\"},{\"checkItemName\":\"空腹血糖（Glu)\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"血糖(空腹)\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":3,\"resultValue\":\"6.37 ↑\",\"textRef\":\"3.9-9.1\",\"unit\":\"mmol/L\"}],\"checkUserName\":\"代斌/凌伟\",\"departmentName\":\"\"},{\"checkItemName\":\"尿常规\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"尿液颜色\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"黄色\",\"textRef\":\"红色-黄色\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"尿透明度\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"透明\",\"textRef\":\"透明\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"尿酸碱度\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"7.0\",\"textRef\":\"5.0-8.4\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"尿亚硝酸盐\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"阴性\",\"textRef\":\"阴性\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"尿葡萄糖\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"阴性\",\"textRef\":\"阴性\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"尿比重\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"1.030\",\"textRef\":\"1.003-1.030\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"尿隐血\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"阴性\",\"textRef\":\"阴性\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"尿蛋白质\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"阴性\",\"textRef\":\"阴性\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"尿胆红素\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"阴性\",\"textRef\":\"阴性\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"尿胆原\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"阴性\",\"textRef\":\"阴性-弱阳性\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"尿酮体\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"阴性\",\"textRef\":\"阴性\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"尿白细胞\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"阴性\",\"textRef\":\"阴性\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"尿白细胞镜检\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":0,\"resultValue\":\"未见\",\"textRef\":\"0-5\",\"unit\":\"/HP\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"尿红细胞镜检\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":0,\"resultValue\":\"未见\",\"textRef\":\"0-3\",\"unit\":\"/HP\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"尿结晶\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见\",\"textRef\":\"\",\"unit\":\"/HP\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"尿液管型\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"未见\",\"textRef\":\"\",\"unit\":\"/LP\"}],\"checkUserName\":\"孙平/凌伟\",\"departmentName\":\"\"},{\"checkItemName\":\"尿微量白蛋白\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"尿微量白蛋白\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"10\",\"textRef\":\"0-80\",\"unit\":\"mg/L\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"尿肌酐\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"300\",\"textRef\":\"0-300\",\"unit\":\"mg/dl\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"ALB/CRE\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"3.33\",\"textRef\":\"0-30\",\"unit\":\"mg/g\"}],\"checkUserName\":\"彭永振/凌伟\",\"departmentName\":\"\"},{\"checkItemName\":\"肾功能(肌酐)\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"血清肌酐\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"64.28\",\"textRef\":\"35-115\",\"unit\":\"umol/L\"}],\"checkUserName\":\"代斌/凌伟\",\"departmentName\":\"\"},{\"checkItemName\":\"糖化血红蛋白（HbA1c）\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"糖化血红蛋白A1c\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"5.9\",\"textRef\":\"4.0-6.0\",\"unit\":\"%\"}],\"checkUserName\":\"彭永振/凌伟\",\"departmentName\":\"\"},{\"checkItemName\":\"铁蛋白\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"铁蛋白\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":3,\"resultValue\":\"991.98 ↑\",\"textRef\":\"32-501\",\"unit\":\"ng/ml\"}],\"checkUserName\":\"许莉蓉/凌伟\",\"departmentName\":\"\"},{\"checkItemName\":\"血常规\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"白细胞计数\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"5.9\",\"textRef\":\"3.5-9.5\",\"unit\":\"10^9/L\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"淋巴细胞百分率\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"34.3\",\"textRef\":\"20-50\",\"unit\":\"%\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"中值细胞百分率\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"4.4\",\"textRef\":\"0-12\",\"unit\":\"%\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"中性粒细胞百分率\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"61.3\",\"textRef\":\"40-75\",\"unit\":\"%\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"淋巴细胞绝对值\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"2.0\",\"textRef\":\"0.8-3.2\",\"unit\":\"10^9/L\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"中值细胞绝对值\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"0.3\",\"textRef\":\"0.1-1.2\",\"unit\":\"10^9/L\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"中性粒细胞绝对值\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"3.6\",\"textRef\":\"1.8-6.3\",\"unit\":\"10^9/L\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"红细胞计数\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"4.81\",\"textRef\":\"4.0-5.8\",\"unit\":\"10^12/L\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"血红蛋白\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"146\",\"textRef\":\"120-175\",\"unit\":\"g/L\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"红细胞压积\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"43.3\",\"textRef\":\"40-50\",\"unit\":\"%\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"平均红细胞体积\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"90.0\",\"textRef\":\"80-100\",\"unit\":\"fl\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"平均红细胞血红蛋白量\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"30.4\",\"textRef\":\"26-34\",\"unit\":\"pg\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"平均红细胞血红蛋白浓度\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"337\",\"textRef\":\"316-354\",\"unit\":\"g/L\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"红细胞体积分布宽度标准差\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"37.3\",\"textRef\":\"37-54\",\"unit\":\"%\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"血小板计数\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"235\",\"textRef\":\"100-350\",\"unit\":\"10^9/L\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"血小板压积\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"0.263\",\"textRef\":\"0.07-0.45\",\"unit\":\"%\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"平均血小板体积\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"10.1\",\"textRef\":\"4-12\",\"unit\":\"fl\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"血小板分布宽度\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"11.1\",\"textRef\":\"10-20\",\"unit\":\"%\"}],\"checkUserName\":\"顾晶晶/凌伟\",\"departmentName\":\"\"},{\"checkItemName\":\"血清r-谷氨酰转肽酶\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"血清r-谷氨酰转肽酶\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":3,\"resultValue\":\"138.89 ↑\",\"textRef\":\"7-64\",\"unit\":\"U/L\"}],\"checkUserName\":\"代斌/凌伟\",\"departmentName\":\"\"},{\"checkItemName\":\"血清低密度脂蛋白\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"血清低密度脂蛋白\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"3.47\",\"textRef\":\"1.30-4.30\",\"unit\":\"mmol/L\"}],\"checkUserName\":\"代斌/凌伟\",\"departmentName\":\"\"},{\"checkItemName\":\"血清甘油三酯\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"血清甘油三酯\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":3,\"resultValue\":\"2.07 ↑\",\"textRef\":\"0.45-1.80\",\"unit\":\"mmol/L\"}],\"checkUserName\":\"代斌/凌伟\",\"departmentName\":\"\"},{\"checkItemName\":\"血清高密度脂蛋白\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"血清高密度脂蛋白\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"1.05\",\"textRef\":\"0.80-1.96\",\"unit\":\"mmol/L\"}],\"checkUserName\":\"代斌/凌伟\",\"departmentName\":\"\"},{\"checkItemName\":\"血清胱抑素C\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"血清胱抑素C\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"0.71\",\"textRef\":\"0.50-1.03\",\"unit\":\"mg/L\"}],\"checkUserName\":\"代斌/凌伟\",\"departmentName\":\"\"},{\"checkItemName\":\"血清尿素氮\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"血清尿素氮\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"4.33\",\"textRef\":\"2.5-8.3\",\"unit\":\"mmol/L\"}],\"checkUserName\":\"代斌/凌伟\",\"departmentName\":\"\"},{\"checkItemName\":\"血清尿酸\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"血清尿酸\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":3,\"resultValue\":\"486.80 ↑\",\"textRef\":\"160-430\",\"unit\":\"μmol/L\"}],\"checkUserName\":\"代斌/凌伟\",\"departmentName\":\"\"},{\"checkItemName\":\"血清总胆固醇\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"血清总胆固醇\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"5.41\",\"textRef\":\"2.33-5.70\",\"unit\":\"mmol/L\"}],\"checkUserName\":\"代斌/凌伟\",\"departmentName\":\"\"},{\"checkItemName\":\"血清总胆红素\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"血清总胆红素\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"14.68\",\"textRef\":\"3.4-24.0\",\"unit\":\"μmol/L\"}],\"checkUserName\":\"代斌/凌伟\",\"departmentName\":\"\"},{\"checkItemName\":\"血粘度检测\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"全血粘度(低切)\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"18.17\",\"textRef\":\"15.63-21.35\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"全血粘度(中切)\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"4.28\",\"textRef\":\"4.05-5.45\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"全血粘度(高切)\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"3.56\",\"textRef\":\"3.40-4.75\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"血浆粘度\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"1.40\",\"textRef\":\"1.20-1.70\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"压积（血粘度）\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"0.43\",\"textRef\":\"0.40-0.50\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"全血还原粘度(低切)\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"38.99\",\"textRef\":\"28.43-50.38\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"全血还原粘度(高切)\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"5.02\",\"textRef\":\"3.47-8.87\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"红细胞聚集指数\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"5.10\",\"textRef\":\"3.29-6.28\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"红细胞刚性指数\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"3.58\",\"textRef\":\"2.04-7.40\",\"unit\":\"\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"红细胞变形指数\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"0.72\",\"textRef\":\"0.49-1.06\",\"unit\":\"\"}],\"checkUserName\":\"彭永振/凌伟\",\"departmentName\":\"\"},{\"checkItemName\":\"肿瘤12检测（男）\",\"checkResults\":[{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"CA199\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"3.33\",\"textRef\":\"0-37\",\"unit\":\"KU/L\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"NSE\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"13.83\",\"textRef\":\"0-15\",\"unit\":\"ng/ml\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"CEA\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"1.76\",\"textRef\":\"0-5\",\"unit\":\"ng/ml\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"C-CA50\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"0.63\",\"textRef\":\"0-30\",\"unit\":\"U/ml\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"TSGF\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"33.1\",\"textRef\":\"0-64\",\"unit\":\"U/ML\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"CYFR21-1\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"0.17\",\"textRef\":\"0-3.3\",\"unit\":\"ng/ml\"},{\"appendInfo\":\"\",\"canExplain\":0,\"checkIndexName\":\"AFP\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"3.67\",\"textRef\":\"0-20\",\"unit\":\"ng/ml\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"游离前列腺特异性抗原\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"0.19\",\"textRef\":\"0-1\",\"unit\":\"ng/ml\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"前列腺特异性抗原(定量)\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"0.89\",\"textRef\":\"0-4.0\",\"unit\":\"ug/L\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"CA125\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"1.88\",\"textRef\":\"0-35\",\"unit\":\"KU/L\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"CA72-4\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"1.34\",\"textRef\":\"0-6\",\"unit\":\"u/ml\"},{\"appendInfo\":\"\",\"canExplain\":1,\"checkIndexName\":\"CA153\",\"highValueRef\":\"\",\"lowValueRef\":\"\",\"resultFlagId\":1,\"resultValue\":\"9.68\",\"textRef\":\"0-28\",\"unit\":\"KU/L\"}],\"checkUserName\":\"韦乾/凌伟\",\"departmentName\":\"\"}],\"generalSummarys\":[{\"fw\":\"\",\"result\":\"\",\"reviewAdvice\":\"\",\"summaryAdvice\":\"应注意避免受凉和劳累，饮食规律，勿过于油腻，勿暴饮暴食，定期复查，如有相关症状请及时就医。\",\"summaryDescription\":\"\",\"summaryMedicalExplanation\":\"胆囊结石主要为胆固醇结石或以胆固醇为主的混合性结石和黑色素结石。\",\"summaryName\":\"胆囊结石\",\"summaryReasonResult\":\"结石形成与肥胖、高胆固醇血症、胆囊炎症、静坐少动习惯有关。\"},{\"fw\":\"\",\"result\":\"\",\"reviewAdvice\":\"\",\"summaryAdvice\":\"建议改变饮食生活习惯，戒酒、减少油腻性食物，坚持适量运动，请定期复查，关注变化。\",\"summaryDescription\":\"\",\"summaryMedicalExplanation\":\"轻度脂肪肝大多数无任何症状，常在体检中发现。\",\"summaryName\":\"脂肪肝趋势\",\"summaryReasonResult\":\"脂肪肝的发生与肥胖、糖尿病、高脂血症、长期嗜酒、脂肪摄入过多和药物等有关。\"},{\"fw\":\"\",\"result\":\"\",\"reviewAdvice\":\"\",\"summaryAdvice\":\"判断甲状腺结节的良恶性主要靠病史、体格检查，放射性核素扫描，穿刺细胞学检查。建议行甲状腺功能检查，定期复查甲状腺彩超观察变化或专科诊治。\",\"summaryDescription\":\"\",\"summaryMedicalExplanation\":\"临床上遇到甲状腺结节时，区别结节的良恶性有重要意义。\",\"summaryName\":\"甲状腺结节（多发）\",\"summaryReasonResult\":\"单纯性甲状腺肿是引起甲状腺结节的重要病因。、①甲状腺炎常见的有亚急性甲状腺炎、慢性淋巴细胞性甲状腺炎、侵袭性纤维性甲状腺炎；②甲状腺腺瘤；③甲状腺囊肿；④甲状腺癌。.\"},{\"fw\":\"7-64 U/L\",\"result\":\"138.89\",\"reviewAdvice\":\"\",\"summaryAdvice\":\"GGT升高，建议及时复查，如果仍然升高，请尽早去医院，查明升高原因。\\n\",\"summaryDescription\":\"\",\"summaryMedicalExplanation\":\"γ-谷氨酰转移酶（GGT或γ-GT），大部分分布于肝细胞毛细胆管和整个胆道系统，在胆汁淤滞时，诱使肝细胞产生大量GGT。酒精性肝损害时血清GGT会明显升高。\\n\\n\",\"summaryName\":\"血清r-谷氨酰转肽酶 增高\",\"summaryReasonResult\":\"GGT检测主要用于了解肝胆系统是否有损伤，增高见于：①原发性或转移肝癌，胰头癌。 \\n②胆道疾病，阻塞性黄疸，胆结石，胆管炎，急性胰腺炎。  \\n③ 急性肝炎，病毒性肝炎、肝硬化活动期。\\n④酒精性肝炎，药物性肝炎等。\\n\\n\"},{\"fw\":\"0-4 \",\"result\":\"4.15\",\"reviewAdvice\":\"\",\"summaryAdvice\":\"动脉粥样硬化指数升高，建议复查血脂，如果总胆固醇和低密度脂蛋白胆固醇升高，建议去医院诊治，查明原因。\",\"summaryDescription\":\"\",\"summaryMedicalExplanation\":\"动脉粥样硬化指数（AI）：是血清胆固醇（TC）减去高密度脂蛋白胆固醇（HDL-C），再除以HDL-C的值，即AI＝TC － HDL-C／HDL-C。若AI＞4.3，是冠心病的高度危险因素。\",\"summaryName\":\"动脉粥样硬化指数 偏高\",\"summaryReasonResult\":\"动脉粥样硬化指数升高，发生冠心病的危险性也升高。\"},{\"fw\":\"0.45-1.80 mmol/L\",\"result\":\"2.07\",\"reviewAdvice\":\"\",\"summaryAdvice\":\"甘油三酯升高与饮食有重要关系，建议素食3天后复查，如果仍然升高，建议低脂饮食，多吃蔬菜水果，适当增加运动，控制体重，定期复查，必要时考虑降脂治疗。\",\"summaryDescription\":\"\",\"summaryMedicalExplanation\":\"甘油三酯(TG)是人体的脂肪成分，能量的贮存形式。肝、脂肪组织及小肠是合成甘油三酯的主要场所，以肝合成能力最强。高脂肪，高碳水化合物饮食，可使体内甘油三酯升高；而甘油三酯升高又是冠心病、脑血管疾病的重要危险因素。\\n\",\"summaryName\":\"血清甘油三酯 增高\",\"summaryReasonResult\":\"血清甘油三酯是高脂血症的重要指标：①甘油三酯增高是冠心病的危险因素。②血清甘油三脂增高见于：家族性脂质代谢紊乱、糖尿病、肥胖症、脂肪肝、动脉粥样硬化、肾病综合征、甲状腺功能低下等。 ③ 当甘油三酯升高>11.3mmol/L时，易发生急性胰腺炎。\\n\"},{\"fw\":\"160-430 μmol/L\",\"result\":\"486.80\",\"reviewAdvice\":\"\",\"summaryAdvice\":\"尿酸升高，建议多喝水，少吃带壳海鲜、动物内脏、豆制品，限喝酒，如出现关节痛、肿，请尽早去医院治疗\",\"summaryDescription\":\"\",\"summaryMedicalExplanation\":\"\\n尿酸（UA) 来源于机体内嘌呤代谢和食物中核酸的分解代谢，是嘌呤代谢的最终产物，肝是尿酸主要生成场所，除小部分尿酸可在肝脏进一步分解或随胆汁排泄外，大部分从肾排泄。血液UA浓度受肾小球滤过功能和肾小管排泌、重吸收功能的综合影响。\\n\\n\\n\",\"summaryName\":\"血清尿酸 增高\",\"summaryReasonResult\":\"尿酸检测主要用于了解肾功能是否有损伤和痛风，增高见于： ①肾功能减退：如急、慢性肾炎，晚期肾结核，严重肾盂肾炎、肾盂积水等。②痛风。③核酸分解代谢增加：如白血病、多发性骨髓瘤、真性红细胞增多症及其他恶性肿瘤等。在肿瘤化疗时血尿酸明显升高。④长期使用利尿剂。\\n\"},{\"fw\":\"3.9-6.1 mmol/L\",\"result\":\"6.37\",\"reviewAdvice\":\"\",\"summaryAdvice\":\"空腹血糖异常，建议及时复查，如果仍然异常，请尽早去医院，查明原因。\\n\",\"summaryDescription\":\"\",\"summaryMedicalExplanation\":\"血糖(blood suger)即血液中的葡萄糖。血糖浓度恒定是受肝脏、神经内分泌激素的调节，当任何调节环节发生障碍，机体会出现一系列的临床症状和病理改变，血糖增高或降低。\\n\",\"summaryName\":\"空腹血糖 增高\",\"summaryReasonResult\":\"空腹血糖增高：①1型2型糖尿病；② 内分泌疾病，如嗜铬细胞瘤、甲亢等；③应急性高血糖，如颅脑外伤，颅内压增高等。\"},{\"fw\":\"32-501 ng/ml\",\"result\":\"991.98\",\"reviewAdvice\":\"\",\"summaryAdvice\":\"血清铁蛋白异常，建议及时复查，如果仍然异常，请尽早去医院，查明原因。\\n\",\"summaryDescription\":\"\",\"summaryMedicalExplanation\":\"铁蛋白是机体内一种贮存铁的可溶性组织蛋白，肝是合成铁蛋白的主要场所。铁蛋白的浓度与体内储存的铁成正比，在机体缺铁时血清铁蛋白水平降低，铁过多时铁蛋白水平升高。对缺铁性贫血的敏感度为90％，特异度为85％。铁蛋白也是一种急性期反应蛋白，在肝脏损伤和某些肿瘤，血清铁蛋白水平可升高。\\n\",\"summaryName\":\"铁蛋白 增高\",\"summaryReasonResult\":\"血清铁蛋白升高原因：①体内贮存铁增加：如反复输血的患者。②铁蛋白合成增加：炎症或感染；恶性疾病，如急性粒细胞白血病、肝癌、胰腺癌等。③组织内的铁蛋白释放增加：肝坏死、慢性肝病。\"}],\"generalSummarys2\":[\"★ 一般检查（体重身高）:\\n   体重指数:23.50\\n   血压:116/86mmHg  舒张压正常高值，建议随访复查。\\n   脉搏:90 次/分\\n\\n\",\"★ 外科检查结果:\\n   右下腹疤痕：阑尾炎术后\\n   直肠指检、前列腺：均弃查\\n   余外科检查未见异常\\n\\n\",\"★ 甲状腺超声:\\n   甲状腺左叶结节（多发）  建议外科随访复查\\n\\n\",\"★ 肝胆脾胰肾彩超:\\n   肝:脂肪肝趋势\\n   胆:胆囊结石  建议外科随访复查\\n   胰、脾、左肾、右肾未发现明显异常\\n\\n\",\"★ CT检查(胸部):\\n   1.胸部CT平扫未见明显异常。\\n   2.附见：左侧甲状腺下叶小圆形略低密度影，建议进一步检查。\\n\\n\",\"★ 血清r-谷氨酰转肽酶 增高:  (结果:138.89 范围：7-64 U/L)\\n\",\"★ 动脉粥样硬化指数 偏高:  (结果:4.15 范围：0-4)\\n\",\"★ 血清甘油三酯 增高:  (结果:2.07 范围：0.45-1.80 mmol/L)\\n\",\"★ 血清尿酸 增高:  (结果:486.80 范围：160-430 μmol/L)\\n\",\"★ 空腹血糖 增高:  (结果:6.37 范围：3.9-6.1 mmol/L)\\n\",\"★ 铁蛋白 增高:  (结果:991.98 范围：32-501 ng/ml)    建议您及时去医院进一步检查。\\n\\n\",\"★ 眼科检查(裂隙灯)、眼科检查(外眼、眼底、眼压)、视力检查:均弃检\"]}";

            Report report = mapper.readValue(reportJson, Report.class);
            return new ReportObjData(userInfo, report);
        } catch (Exception e) {
            logger.info("解析报告{}出错,可能不存在这个报告,或者该报告缺少userInfo or reportContent", reportId);
            return null;
        }
    }

    private boolean userInfoIsLegal(UserInfo userInfo) {
        return (userInfo.getSex() == 0 || userInfo.getSex() == 1) && userInfo.getAge() >= 18 && userInfo.getAge() <= 65;
    }

    private String findIndex(String checkIndexName, String resultValue, String textRef) {
        return checkIndexRegexMap.entrySet().stream()
                .filter(x -> isLegalCheckIndexName(checkIndexName, x.getValue()) && isLegalValue(x.getKey(), resultValue, textRef))
                .map(Map.Entry::getKey)
                .findFirst().orElse("");

    }

    private boolean isLegalValueTextRef(String checkIndexNameStd, String textRef, String resultValue) {
        List<Double> parsedTextRefList = findDoubles(textRef);
        if (parsedTextRefList.size() != 2) //参考范围解析后不符合要求
            return false;
        Tuple<Double, Double> minMaxRefStd = textRefMap.get(checkIndexNameStd);
        double minCompare = Math.abs(parsedTextRefList.get(0) - minMaxRefStd.getT1()) / (minMaxRefStd.getT1()); //参考范围和标准参考范围的最小值的偏差
        double maxCompare = Math.abs(parsedTextRefList.get(1) - minMaxRefStd.getT2()) / (minMaxRefStd.getT2()); //参考范围和标准参考范围的最大值的偏差
        if (minCompare > 0.1 || maxCompare > 0.1) //参考范围与标准参考范围偏差太大。不符合要求
            return false;
        List<Double> parsedResultValueList = findDoubles(resultValue);
        if (parsedResultValueList.size() != 1) //结果值解析后不符合要求
            return false;
        Double value = parsedResultValueList.get(0);
        //验证空腹血糖的结果值是否在正常范围内
        return !"血糖（空腹）".equals(checkIndexNameStd) || (!(value < 3.9) && value <= 7);
    }

    private boolean isLegalValue(String checkIndexNameStd, String resultValue, String textRef) {
        boolean result;
        if (textRefMap.containsKey(checkIndexNameStd)) { // 参考范围也要验证，如2.33-5.7
            result = isLegalValueTextRef(checkIndexNameStd, textRef, resultValue);
        } else { // 不验证参考范围
            result = findDoubles(resultValue).size() == 1;
        }
        return result;
    }

    private boolean isLegalCheckIndexName(String checkIndexName, String checkIndexNameRegex) {
        return checkIndexName.matches(checkIndexNameRegex) && !checkIndexName.matches(excludeRegex);
    }

    private List<Double> findDoubles(String text) {
        return stream(text.split("[^\\d.]"))
                .filter(x -> !"".equals(x))
                .mapToDouble(Double::parseDouble)
                .boxed().collect(toList());
    }

    private boolean reportIsLegal(Report report) {
        CheckItem[] tt = report.getCheckItems();
        List<String> legalCheckIndexList = stream(report.getCheckItems())
                .flatMap(checkItem -> stream(checkItem.getCheckResults()))
                .map(checkResult -> findIndex(checkResult.getCheckIndexName(), checkResult.getResultValue(), checkResult.getTextRef()))
                .filter(checkIndex -> !"".equals(checkIndex))
                .collect(toList());

        Set<String> legalCheckIndexSet = new HashSet<>(legalCheckIndexList);
        logger.info(legalCheckIndexSet.toString());
        return (legalCheckIndexList.size() == legalCheckIndexSet.size()) && legalCheckIndexSet.size() == checkIndexRegexMap.size();
    }

    public boolean isLegal(ReportObjData reportObjData) {
        return (reportObjData != null)
                && userInfoIsLegal(reportObjData.getUserInfo())
                && reportIsLegal(reportObjData.getReport());
    }
}
